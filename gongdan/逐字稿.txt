# 电商实时数仓 - 用户价值诊断看板逐字稿

大家好，今天我们要讲解的是电商实时数仓项目中的一个重要模块 - 用户价值诊断看板。

## 一、项目背景与目标

首先来看一下项目的背景。在电商场景中，我们经常面临一个问题：用户价值模糊，运营策略缺乏针对性。为了解决这个问题，我们基于电商实时数仓的技术架构，设计了用户价值诊断看板。

这个看板通过"活跃贡献、消费能力、复购忠诚、互动参与、流失风险"这五大维度来评估用户价值等级，实现用户分层，包括高价值用户、中价值用户、潜力用户和流失预警用户，并为不同层级的用户提供个性化的运营策略。

核心目标是提升用户生命周期总价值（LTV），帮助运营团队精准触达高价值用户、激活潜力用户、挽回流失风险用户。

## 二、ADS层表结构分析

接下来我们来看一下ADS层的表结构设计。

我们一共设计了8张核心表：

1. `ads_user_active_metrics_result` - 活跃贡献指标结果表，统计用户的月活跃天数、周活跃频率、访问深度等指标
2. `ads_user_consume_metrics_result` - 消费能力指标结果表，统计用户近30天消费总额、客单价等
3. `ads_user_repurchase_metrics_result` - 复购忠诚指标结果表，统计用户近90天复购次数等
4. `ads_user_interaction_metrics_result` - 互动参与指标结果表，统计用户评论次数、分享次数等
5. `ads_user_churn_metrics_result` - 流失风险指标结果表，评估用户流失风险
6. `ads_user_comprehensive_score_result` - 用户综合价值得分表，整合五个维度得分
7. `ads_user_group_comparison_result` - 用户群体对比表，与同群体用户进行对比
8. `ads_user_value_main` - 用户价值主表，面向看板展示的核心表

## 三、核心实现方案

现在我们重点讲解一下核心实现方案。

### 1. 五维价值指标体系

我们的指标体系包含五个维度，每个维度有不同的权重：

- 活跃贡献占25%，主要看月活跃天数、周活跃频率和访问深度
- 消费能力占30%，看消费总额、客单价和高价值商品购买占比
- 复购忠诚占20%，关注复购次数、复购间隔和会员等级
- 互动参与占15%，统计评论、分享和优惠券使用情况
- 留存潜力占10%，这是流失风险的逆向指标

### 2. 评分计算逻辑

评分计算分为三步：

第一步是子指标标准化，使用Min-Max标准化将原始指标映射到0-100分
第二步是维度得分计算，按权重加权各子指标
第三步是综合总分计算，按维度权重计算最终得分

比如活跃贡献得分 = 活跃天数标准分×40% + 活跃频率标准分×30% + 访问深度标准分×30%

### 3. 用户分级逻辑

根据综合得分进行用户分级：
- 85分以上为高价值用户/A级
- 70-85分为中价值用户/B级
- 50-70分为潜力用户/C级
- 50分以下为流失预警用户/D级

## 四、数据处理流程

数据从Kafka流入，经过ODS、DWD、DWS层处理，最终写入ADS层。

在ODS层，我们原样存储Kafka的原始数据
在DWD层，构建各业务域的事实表
在DWS层，按用户和日期进行轻度聚合
在ADS层，计算五维得分并写入结果表

我们使用Flink进行实时计算，同时每天凌晨全量重算近90天的数据以处理历史补录场景。

## 五、关键技术实现

在技术实现上，我们采用双级分区策略避免单分区过大，在存储上启用ZSTD压缩降低存储占用，并为常用查询字段建立索引提升查询效率。

在Flink配置上，我们使用HashMapStateBackend，设置5分钟Checkpoint间隔，保证计算的稳定性和准确性。

## 六、验证方案

为了确保计算准确性，我们设计了三套验证方案：

1. 总分计算准确性验证，重新计算总分并与存储值对比
2. 分级逻辑准确性验证，检查得分与用户等级是否匹配
3. 业务逻辑验证，包括极端值测试、权重敏感性测试等

## 七、交付物

最终交付物包括：
- 完整的设计文档
- Flink实现代码，包括SQL脚本和DataStream代码
- 测试文档和测试报告
- 生产和测试环境的上线截图

这就是我们用户价值诊断看板的完整设计方案。通过这个看板，运营团队可以更好地理解用户价值，制定更精准的运营策略。
