商品排行看板设计文档

1. 基本信息
   工单编号: 大数据-电商数仓-02-商品主题商品排行看板
   项目名称: 电商数仓
   创建人: 郭洵
   创建时间: 2025.1.25
   项目目标: 构建商品排行看板，帮助商家分析热销商品，优化商品策略
2. 功能需求分析
   2.1 商品排行看板
   全部商品排行：
   按销售额、销量等指标展示商品排行
   支持不同分类下的商品排行
   时间维度：日、周、月、7天、30天、自定义
   展示形式：列表/报表
   支付转化率 = 支付买家数 / 商品访客数（访问商品详情页的人数）
   流销词展示：
   流：TOP10 流量来源（访客数、支付转化率）
   销：TOP5 SKU 销售情况
   词：TOP10 搜索词
   交互功能：
   趋势：查看商品数据趋势
   详情：跳转至商品 360 分析页面
   关注、运营策略、智能诊断建议等操作
   2.2 价格力商品排行看板
   商品概览：展示价格力优秀、良好、较差的商品数量
   预警：
   价格力预警：持续低星商品或高价识别商品
   商品力预警：访问或支付转化率低于市场平均且环比下降的商品
   商品排行：
   展示商品价格力星级和普惠券后价
   支持指标勾选、实时分析、历史分析、价格力提升等操作
3. 数据架构设计
   3.1 数据来源
   ODS 层：
   ods_product_info：商品基本信息
   ods_product_sale_info：商品销售信息
   ods_shop_visit_log：店铺访问日志
   ods_search_log：搜索日志
   DIM 层：
   dim_product_category：商品分类维度
   dim_traffic_source：流量来源维度
   DWD 层：
   dwd_product_visit_detail：商品访问明细
   dwd_product_sale_detail：商品销售明细
   dwd_product_search_detail：商品搜索明细
   DWS 层：
   dws_product_sale_summary：商品销售汇总
   dws_product_visit_summary：商品访问汇总
   dws_sku_sale_summary：SKU销售汇总
   dws_search_word_summary：搜索词汇总
   ADS 层：
   ads_hot_product_ranking：热门商品排行
   ads_category_sale_ranking：商品分类销售排行
   ads_hot_search_word：热门搜索词
   ads_platform_core_index：平台核心指标
   3.2 ADS 层表设计
   5.1 不分层实现
   直接从 DWD 层表中聚合数据，生成 ADS 层表。
   所有计算逻辑在 Spark SQL 或 PySpark 中完成。
   适合数据量较小或实时性要求高的场景。
   5.2 分层实现
   ODS 层：原始数据导入
   DIM 层：维度数据导入
   DWD 层：清洗和标准化数据
   DWS 层：按维度聚合数据
   ADS 层：最终指标计算和展示
   适合数据量大、逻辑复杂、需要复用中间结果的场景
4. 代码实现要点
   工单编号注释：所有代码文件需包含 # 大数据-电商数仓-02-商品主题商品排行看板 注释
   指标计算：使用 Spark SQL 或 PySpark 实现上述指标计算逻辑
   数据写入：使用 Parquet 格式存储，分区字段为 stat_period
   数据验证：通过 SQL 查询验证数据一致性和准确性
5. 验收标准
   设计文档完整，包含表结构设计、指标实现方案和实现思路
   代码实现所有功能，包含分层和不分层两种方式，并有详细注释
   测试文档包含测试记录和验证 SQL，两种实现方式数据一致
   上线截图包含时间和指标数值，清晰可见
   通过以上设计文档，可以指导开发团队完成商品排行看板的开发、测试和上线工作。
6.

ADS层表分析

1. ads_platform_core_index (平台核心指标表)
   分组字段：
   stat_date (统计日期)
   stat_period (统计周期)
   聚合字段：
   total_visitor_num (总访客数)
   total_visit_num (总访问次数)
   total_order_num (总订单数)
   total_sales_amount (总销售额)
   avg_order_amount (平均订单金额)
   pay_conversion_rate (支付转化率)
   visitor_avg_stay_time (访客平均停留时间)
   yoy_growth_rate (同比增长率)
   mom_growth_rate (环比增长率)
   适合图表类型：
   折线图：展示核心指标随时间的变化趋势
   柱状图：对比不同周期的销售额和订单数
   仪表盘：展示关键指标的当前状态
   面积图：展示访客数和访问次数的趋势变化
   数据来源追溯：
   源表：dws_product_visit_summary、dws_product_sale_summary、dwd_product_visit_detail
   ODS层：ods_shop_visit_log、ods_product_sale_info、ods_product_info
2. ads_category_sale_ranking (商品分类销售排行表)
   分组字段：
   stat_date (统计日期)
   stat_period (统计周期)
   category_id (分类ID)
   category_name (分类名称)
   聚合字段：
   total_sales_amount (总销售额)
   total_sales_num (总销量)
   sales_rank (销售排名)
   sales_contribution (销售额贡献占比)
   适合图表类型：
   柱状图：展示不同分类的销售额对比
   饼图：展示各分类销售额贡献占比
   排名图：展示分类销售排名变化
   热力图：展示分类销售表现矩阵
   数据来源追溯：
   源表：dws_product_sale_summary
   ODS层：ods_product_sale_info、ods_product_info
3. ads_hot_product_ranking (热门商品排行表)
   分组字段：
   stat_date (统计日期)
   stat_period (统计周期)
   product_id (商品ID)
   product_name (商品名称)
   category_id (分类ID)
   聚合字段：
   total_sales_amount (总销售额)
   total_visit_num (总访问次数)
   conversion_rate (转化率)
   hot_rank (热度排名)
   适合图表类型：
   排名图：展示商品热度排名
   散点图：分析销售额与访问量的关系
   柱状图：对比热门商品的各项指标
   雷达图：展示单个商品在多个维度的表现
   数据来源追溯：
   源表：dws_product_sale_summary、dws_product_visit_summary
   ODS层：ods_product_sale_info、ods_shop_visit_log、ods_product_info
4. ads_hot_search_word (热门搜索词表)
   分组字段：
   stat_date (统计日期)
   stat_period (统计周期)
   search_word (搜索词)
   聚合字段：
   total_search_num (总搜索次数)
   click_rate (点击转化率)
   search_rank (搜索排名)
   related_hot_product_ids (相关热门商品ID)
   适合图表类型：
   词云图：展示热门搜索词
   柱状图：对比搜索词的搜索次数和点击率
   排名图：展示搜索词排名变化
   关系图：展示搜索词与商品的关联关系
   数据来源追溯：
   源表：dws_search_word_summary、dwd_product_search_detail、dwd_product_sale_detail、ads_hot_product_ranking
   ODS层：ods_search_log、ods_product_sale_info、ods_shop_visit_log、ods_product_info